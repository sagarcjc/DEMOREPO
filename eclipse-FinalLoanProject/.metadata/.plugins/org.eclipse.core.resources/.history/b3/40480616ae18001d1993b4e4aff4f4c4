package com.AceHomeLoan.app.Controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestPart;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import com.AceHomeLoan.app.ServiceI.CustomerApplicationServiceI;
import com.AceHomeLoan.app.model.CustomerApplicationFrom;
import com.AceHomeLoan.app.model.Profession;
import com.fasterxml.jackson.databind.ObjectMapper;

@CrossOrigin("*")
@RestController
public class CustomerApplicationController 
{
	@Autowired
	CustomerApplicationServiceI customerservice;
	
	@PostMapping(value="CustomerApplicationForm" ,consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
	public String saveCustomerApplication(@RequestPart ("professionsalarySlips") MultipartFile file,
			@RequestPart ("propertyProof") MultipartFile file1,@RequestPart ("pInscurance") MultipartFile file2,
            @RequestPart("profession") String profession)
	{
		ObjectMapper om=new ObjectMapper();
		CustomerApplicationFrom customerAppl;
		try {
			customerAppl = om.readValue(profession,CustomerApplicationFrom.class);
			customerAppl.getCustomerProfession().setProfessionsalarySlips(file.getBytes());
			customerAppl.getMortgage().setPInscurance(file2.getBytes());
			customerAppl.getMortgage().setPropertyProof(file1.getBytes());
			
			customerservice.saveCustomerApplication(customerAppl);
			return "data save successfully";
			
		}catch (Exception e) {
			
			// TODO: handle exception
		}
		
		return "save customer form";
	}
}
